/*! @license
 Slip.js 1.2.0

 © 2014 Kornel Lesiński <kornel@geekhood.net>. All rights reserved.

 Redistribution and use in source and binary forms, with or without modification,
 are permitted provided that the following conditions are met:

 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.

 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
 the following disclaimer in the documentation and/or other materials provided with the distribution.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
 INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
 USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
window.Slip=function(){"use strict";function o(a,b){if("string"==typeof a&&(a=document.querySelector(a)),!a||!a.addEventListener)throw new Error("Please specify DOM node to attach to");if(!this||this===window)return new o(a,b);this.options=b=b||{},this.options.keepSwipingPercent=b.keepSwipingPercent||0,this.options.minimumSwipeVelocity=b.minimumSwipeVelocity||1,this.options.minimumSwipeTime=b.minimumSwipeTime||110,this.cancel=this.setState.bind(this,this.states.idle),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onSelection=this.onSelection.bind(this),this.onContainerFocus=this.onContainerFocus.bind(this),this.setState(this.states.idle),this.attach(a)}function p(a){var b=a.style[g];if(b)return{value:b,original:b};if(window.getComputedStyle){var c=window.getComputedStyle(a).getPropertyValue(h);if(c&&"none"!==c)return{value:c,original:""}}return{value:"",original:""}}function q(a,b){for(var c=0,d=0,e=0;e<b.length;e++)1===b[e].nodeType&&(d++,b[e]===a.node&&(c=d-1));return c}var a={container:{ariaRole:"listbox",tabIndex:0,focus:!1},items:{ariaRole:"option",tabIndex:-1,focus:!1}},b=/Chrome\/[3-5]/.test(navigator.userAgent),c=b,d=b,e=document.createElement("div").style,f="transition"in e?"transition":"webkitTransition",g="transform"in e?"transform":"webkitTransform",h="webkitTransform"===g?"-webkit-transform":"transform",i="userSelect"in e?"userSelect":"webkitUserSelect";e[g]="translateZ(0)";var j=e[g]?"translateZ(0) ":"",k=e[g]?"translateZ(1px) ":"";e=null;var l=0,m=!1,n=function(){};return o.prototype={container:null,options:{},state:null,target:null,usingTouch:!1,mouseHandlersAttached:!1,startPosition:null,latestPosition:null,previousPosition:null,canPreventScrolling:!1,states:{idle:function(){return this.removeMouseHandlers(),this.target&&(this.target.node.style.willChange="",this.target=null),this.usingTouch=!1,{allowTextSelection:!0}},undecided:function(){if(this.target.height=this.target.node.offsetHeight,this.target.node.style.willChange=h,this.target.node.style[f]="",this.dispatch(this.target.originalTarget,"beforewait"))var b=setTimeout(function(){var a=this.getAbsoluteMovement();this.canPreventScrolling&&a.x<15&&a.y<25&&this.dispatch(this.target.originalTarget,"beforereorder")&&this.setState(this.states.reorder)}.bind(this),300);else this.dispatch(this.target.originalTarget,"beforereorder")&&this.setState(this.states.reorder);return{leaveState:function(){clearTimeout(b)},onMove:function(){var a=this.getAbsoluteMovement();if(a.x>20&&a.y<Math.max(100,this.target.height)){if(this.dispatch(this.target.originalTarget,"beforeswipe",{directionX:a.directionX,directionY:a.directionY}))return this.setState(this.states.swipe),!1;this.setState(this.states.idle)}if(a.y>20&&this.setState(this.states.idle),a.x>1.2*a.y)return!1},onLeave:function(){this.setState(this.states.idle)},onEnd:function(){var a=this.dispatch(this.target.originalTarget,"tap");return this.setState(this.states.idle),a}}},swipe:function(){function e(){c.classList.remove("slip-swiping-container")}var b=!1,c=this.container,d=q(this.target,this.container.childNodes);return c.classList.add("slip-swiping-container"),this.target.height=this.target.node.offsetHeight,{leaveState:function(){b?this.animateSwipe(function(a){if(a.node.style[g]=a.baseTransform.original,a.node.style[f]="",this.dispatch(a.node,"afterswipe"))return e(),!0;this.animateToZero(void 0,a)}.bind(this)):this.animateToZero(e)},onMove:function(){var a=this.getTotalMovement();if(Math.abs(a.y)<this.target.height+20)return this.dispatch(this.target.node,"animateswipe",{x:a.x,originalIndex:d})&&(this.target.node.style[g]="translate("+a.x+"px,0) "+j+this.target.baseTransform.value),!1;this.dispatch(this.target.node,"cancelswipe"),this.setState(this.states.idle)},onLeave:function(){this.state.onEnd.call(this)},onEnd:function(){var a=this.getAbsoluteMovement(),c=a.x/a.time,e=100*Math.abs((this.startPosition.x-this.previousPosition.x)/this.container.clientWidth),f=c>this.options.minimumSwipeVelocity&&a.time>this.options.minimumSwipeTime||this.options.keepSwipingPercent&&e>this.options.keepSwipingPercent;return f?this.dispatch(this.target.node,"swipe",{direction:a.directionX,originalIndex:d})&&(b=!0):this.dispatch(this.target.node,"cancelswipe"),this.setState(this.states.idle),!f}}},reorder:function(){function s(){this.updateScrolling(),l&&(clearTimeout(l),l=null);var a=this.getTotalMovement();this.target.node.style[g]="translate(0,"+a.y+"px) "+k+this.target.baseTransform.value;var b=this.target.height;return n.forEach(function(c){var d=0;c.pos<0&&a.y<0&&c.pos>a.y?d=b:c.pos>0&&a.y>0&&c.pos<a.y&&(d=-b),c.node.style[g]=d?"translate(0,"+d+"px) "+j+c.baseTransform.value:c.baseTransform.original}),!1}this.target.node.focus&&a.items.focus&&this.target.node.focus(),this.target.height=this.target.node.offsetHeight;for(var l,c=this.container.childNodes,e=q(this.target,c),m=this.target.node.offsetTop+this.target.height/2,n=[],o=0;o<c.length;o++)if(1==c[o].nodeType&&c[o]!==this.target.node){var r=c[o].offsetTop;c[o].style[f]=h+" 0.2s ease-in-out",n.push({node:c[o],baseTransform:p(c[o]),pos:r+(r<m?c[o].offsetHeight:0)-m})}return this.target.node.classList.add("slip-reordering"),this.target.node.style.zIndex="99999",this.target.node.style[i]="none",d&&(this.container.style.webkitTransformStyle="preserve-3d"),s.call(this),{leaveState:function(){l&&clearTimeout(l),d&&(this.container.style.webkitTransformStyle=""),this.container.focus&&a.container.focus&&this.container.focus(),this.target.node.classList.remove("slip-reordering"),this.target.node.style[i]="",this.animateToZero(function(a){a.node.style.zIndex=""}),n.forEach(function(a){a.node.style[g]=a.baseTransform.original,a.node.style[f]=""})},onMove:s,onLeave:function(){l&&clearTimeout(l),l=setTimeout(function(){l=null,this.cancel()}.bind(this),700)},onEnd:function(){var b,c,a=this.getTotalMovement();if(a.y<0){for(b=0;b<n.length&&!(n[b].pos>a.y);b++);c=b}else{for(b=n.length-1;b>=0&&!(n[b].pos<a.y);b--);c=b+1}return this.dispatch(this.target.node,"reorder",{spliceIndex:c,originalIndex:e,insertBefore:n[c]?n[c].node:null}),this.setState(this.states.idle),!1}}}},attach:function(b){l++,this.container&&this.detach(),!m&&c&&(m=!0,document.body.addEventListener("touchstart",n,!1)),this.container=b,!1!==a.container.tabIndex&&(this.container.tabIndex=a.container.tabIndex),a.container.ariaRole&&this.container.setAttribute("aria-role",a.container.ariaRole),this.setChildNodesAriaRoles(),this.container.addEventListener("focus",this.onContainerFocus,!1),this.otherNodes=[],document.addEventListener("selectionchange",this.onSelection,!1),this.container.addEventListener("touchcancel",this.cancel,!1),this.container.addEventListener("touchstart",this.onTouchStart,!1),this.container.addEventListener("touchmove",this.onTouchMove,!1),this.container.addEventListener("touchend",this.onTouchEnd,!1),this.container.addEventListener("mousedown",this.onMouseDown,!1)},detach:function(){this.cancel(),this.container.removeEventListener("mousedown",this.onMouseDown,!1),this.container.removeEventListener("touchend",this.onTouchEnd,!1),this.container.removeEventListener("touchmove",this.onTouchMove,!1),this.container.removeEventListener("touchstart",this.onTouchStart,!1),this.container.removeEventListener("touchcancel",this.cancel,!1),document.removeEventListener("selectionchange",this.onSelection,!1),!1!==a.container.tabIndex&&this.container.removeAttribute("tabIndex"),a.container.ariaRole&&this.container.removeAttribute("aria-role"),this.unSetChildNodesAriaRoles(),!--l&&m&&(m=!1,document.body.removeEventListener("touchstart",n,!1))},setState:function(a){if(this.state){if(this.state.ctor===a)return;this.state.leaveState&&this.state.leaveState.call(this)}var b=this.state,c=a.call(this);this.state===b&&(c.ctor=a,this.state=c)},findTargetNode:function(a){for(;a&&a.parentNode!==this.container;)a=a.parentNode;return a},onContainerFocus:function(a){this.setChildNodesAriaRoles()},setChildNodesAriaRoles:function(){for(var b=this.container.childNodes,c=0;c<b.length;c++)1==b[c].nodeType&&(a.items.ariaRole&&b[c].setAttribute("aria-role",a.items.ariaRole),!1!==a.items.tabIndex&&(b[c].tabIndex=a.items.tabIndex))},unSetChildNodesAriaRoles:function(){for(var b=this.container.childNodes,c=0;c<b.length;c++)1==b[c].nodeType&&(a.items.ariaRole&&b[c].removeAttribute("aria-role"),!1!==a.items.tabIndex&&b[c].removeAttribute("tabIndex"))},onSelection:function(a){var b=a.target===document||this.findTargetNode(a),c=/(iPhone|iPad|iPod)/i.test(navigator.userAgent)&&!/(Android|Windows)/i.test(navigator.userAgent);b&&(c?this.setState(this.states.idle):this.state.allowTextSelection||a.preventDefault())},addMouseHandlers:function(){this.mouseHandlersAttached||(this.mouseHandlersAttached=!0,document.documentElement.addEventListener("mouseleave",this.onMouseLeave,!1),window.addEventListener("mousemove",this.onMouseMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0),window.addEventListener("blur",this.cancel,!1))},removeMouseHandlers:function(){this.mouseHandlersAttached&&(this.mouseHandlersAttached=!1,document.documentElement.removeEventListener("mouseleave",this.onMouseLeave,!1),window.removeEventListener("mousemove",this.onMouseMove,!0),window.removeEventListener("mouseup",this.onMouseUp,!0),window.removeEventListener("blur",this.cancel,!1))},onMouseLeave:function(a){this.usingTouch||a.target!==document.documentElement&&a.relatedTarget!==document.documentElement||this.state.onLeave&&this.state.onLeave.call(this)},onMouseDown:function(a){!this.usingTouch&&0==a.button&&this.setTarget(a)&&(this.addMouseHandlers(),this.canPreventScrolling=!0,this.startAtPosition({x:a.clientX,y:a.clientY,time:a.timeStamp}))},onTouchStart:function(a){if(this.usingTouch=!0,this.canPreventScrolling=!0,a.touches.length>1)return void this.setState(this.states.idle);this.setTarget(a)&&this.startAtPosition({x:a.touches[0].clientX,y:a.touches[0].clientY,time:a.timeStamp})},setTarget:function(a){var b=this.findTargetNode(a.target);if(!b)return this.setState(this.states.idle),!1;for(var c=b.parentNode;c&&c!=document.body&&!(c.scrollHeight>c.clientHeight&&"visible"!=window.getComputedStyle(c)["overflow-y"]);)c=c.parentNode;return c=c||document.body,this.target={originalTarget:a.target,node:b,scrollContainer:c,origScrollTop:c.scrollTop,origScrollHeight:c.scrollHeight,baseTransform:p(b)},!0},startAtPosition:function(a){this.startPosition=this.previousPosition=this.latestPosition=a,this.setState(this.states.undecided)},updatePosition:function(a,b){null!=this.target&&(this.latestPosition=b,this.state.onMove&&!1===this.state.onMove.call(this)&&a.preventDefault(),this.latestPosition.time-this.previousPosition.time>100&&(this.previousPosition=this.latestPosition))},onMouseMove:function(a){this.updatePosition(a,{x:a.clientX,y:a.clientY,time:a.timeStamp})},onTouchMove:function(a){this.updatePosition(a,{x:a.touches[0].clientX,y:a.touches[0].clientY,time:a.timeStamp}),this.canPreventScrolling=!1},onMouseUp:function(a){this.usingTouch||0!==a.button||this.state.onEnd&&!1===this.state.onEnd.call(this)&&a.preventDefault()},onTouchEnd:function(a){a.touches.length>1?this.cancel():this.state.onEnd&&!1===this.state.onEnd.call(this)&&a.preventDefault()},getTotalMovement:function(){var a=this.target.scrollContainer.scrollTop-this.target.origScrollTop;return{x:this.latestPosition.x-this.startPosition.x,y:this.latestPosition.y-this.startPosition.y+a,time:this.latestPosition.time-this.startPosition.time}},getAbsoluteMovement:function(){var a=this.getTotalMovement();return{x:Math.abs(a.x),y:Math.abs(a.y),time:a.time,directionX:a.x<0?"left":"right",directionY:a.y<0?"up":"down"}},updateScrolling:function(){var a=40,b=0,c=this.target.scrollContainer,d=c.getBoundingClientRect(),e=this.target.node.getBoundingClientRect(),f=Math.min(d.bottom,window.innerHeight)-e.bottom,g=e.top-Math.max(d.top,0),h=this.target.origScrollHeight-Math.min(c.clientHeight,window.innerHeight);f<a?b=Math.min(a,a-f):g<a&&(b=Math.max(-a,g-a)),c.scrollTop=Math.max(0,Math.min(h,c.scrollTop+b))},dispatch:function(a,b,c){var d=document.createEvent("CustomEvent");return d&&d.initCustomEvent?d.initCustomEvent("slip:"+b,!0,!0,c):(d=document.createEvent("Event"),d.initEvent("slip:"+b,!0,!0),d.detail=c),a.dispatchEvent(d)},getSiblings:function(a){for(var b=[],c=a.node.nextSibling;c;)1==c.nodeType&&b.push({node:c,baseTransform:p(c)}),c=c.nextSibling;return b},animateToZero:function(a,b){b=b||this.target,b.node.style[f]=h+" 0.1s ease-out",b.node.style[g]="translate(0,0) "+j+b.baseTransform.value,setTimeout(function(){b.node.style[f]="",b.node.style[g]=b.baseTransform.original,a&&a.call(this,b)}.bind(this),101)},animateSwipe:function(a){var b=this.target,c=this.getSiblings(b),d="translate(0,"+this.target.height+"px) "+j+" ";b.node.style[f]="all 0.1s linear",b.node.style[g]=" translate("+(this.getTotalMovement().x>0?"":"-")+"100%,0) "+j+b.baseTransform.value,setTimeout(function(){a.call(this,b)&&(c.forEach(function(a){a.node.style[f]="",a.node.style[g]=d+a.baseTransform.value}),setTimeout(function(){c.forEach(function(a){a.node.style[f]=h+" 0.1s ease-in-out",a.node.style[g]="translate(0,0) "+j+a.baseTransform.value}),setTimeout(function(){c.forEach(function(a){a.node.style[f]="",a.node.style[g]=a.baseTransform.original})},101)},1))}.bind(this),101)}},"function"==typeof define&&define.amd&&define(function(){return o}),o}();